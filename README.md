![Тестовое задание](http://memesmix.net/media/created/6d7isv.jpg)
# Сервис хранения и обработки сделок.
Используемые технологии: Python3.8, Django3.2, PostgreSQL 11, Django Rest Framework 3.12, django-environ 0.4.5, uWSGI 2.0.19

####Внимание!
Это **тестовое** задание!
Здесь описан только код и не реализованы меры безопасности !
Для полноценного развертывания на продакшене необходимо вынести все чувствитльные к секьюрности данные из проекта
в переменные окружения!

Как запустить эту штуковину ?
1) Cклонировать проект с гитхаба ```git clone https://github.com/dshwets/sib_dev_test.git```
2) Зайти в папку проекта ```cd sib_dev_test/```
3) Выполнить команду ```docker-compose up```
4) Наслаждаться рабочим приложением.

Для развертывания проекта вне докера(для дебага или разработки):

1) Находясь в папке проекта выполнить комманду ```virtualenv -p python3 venv```
2) Активировать виртуальное окружение ```. venv/bin/activate```
3) Установить все необходимые для работы проекта либы ```pip install -r requirements.txt```
4) #####В  файле ```/source/main/settings.py``` необходимо указать реквизиты базы данных PostgreSQL развернутой на вашей локальной машине.
5) Провести миграции: ```./source/manage.py migrate```
6) Запустить приложение коммандой : ```./source/manage.py runserver```


####Что можно делать в этом приложении ?
В данном приложении релизован функционал сохрениня в бд и обработки типизированных .csv файлов.

Как работать с сервисом ?

- Подразумевается, что на сервис будут загружаться типизированные .csv файлы, в которых храняться списки транзакций.
    
    Пример данных из .csv файла:
    
    | customer        | item           | total  | quantity  | date  |
    | ------------- |:-------------:| -----:| -----:| -----:|
    | bellwether| Цаворит | 612 |6 |2018-12-14 08:29:52.506166 |
    | resplendent| Сапфир | 8502 |6 |2018-12-14 14:43:45.883282 |
    | buckaroo| Рубин | 342 |2 |2018-12-15 15:00:59.858739 |
    | zygote4id3n| Яшма | 264 |3 |2018-12-16 00:01:13.013713 |
    
    После чего данные из файла сохраняются в базу.
- Происходит гет запрос на сервис, который возвращает в respons'e 5 клиентов, потративших наибольшую сумму денег на покупку камней,
исходя из последнего загруженного файла deals.csv. В возвращаеммых данных у каждого клиента присутствуют следующиеполя:
    
        1)username - логин клиента.
        2)speny_money - сумма потраченных средств за весь педоставленный период. 
        3)gems  - список из камней, который прибритал как клиент, так и как минимум 1 человек из списка 5 самых
        крупных клиентов(камни, которые покупал только конкретный клиент и более никто из списка 5 самых крупных
         клиентов не отображаются в этом списке)
  

####API
1. Предоставлен роут http://{host}:8000/api_v1/deals, где доступен POST запрос, в теле которого должен содержаться .csv
файл c ключом file.
Ниже приведен пример успешного запроса Postman'ом.
![Скриншот успешного POST запросе из Postman'a](https://i.imgur.com/wKNuBoP.png)
В случае если файл был частично поврежден или в какой-то строке содерижтся ошибка, не поврежденные строки будут
 записаны в базу а остальные(поврежденные строки будут указаны в ответе сервиса).
 Пример ответа в случае если строк(а/и) , были повреждены.```{"invalid_data_strings:": "5 "}```
 2. Предоставлен роут http://{host}:8000/api_v1/top_customers, где доступен GET запрос.
Ниже приведен пример успешного запроса POstman'ом.
![Cкриншот успешного GET запроса из POstman'a](https://i.imgur.com/eb9IEn7.png)

###Куда звонить если все сломалось и ниего не работает ?

![Картинка горящего дома](https://memepedia.ru/wp-content/uploads/2017/04/disaster-girl.jpg)

В случае если у вас возникли проблемы с приложением прошу связаться со мной в телеграме @Dannystyw или по почте dshwets@gmail.com